@model AdminDashboard.Models.SiteModels.PackageListModel
@{
    ViewData["Title"] = "Packages";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<div class="section mt-5 Packages">
    <div class="container">
        <div class="row">
            <p>Did you have special request?  @Html.ActionLink("Contact Us", "Index", "SitePackagesController")</p>
            <div class="col-12" data-aos="fade-up" data-aos-delay="0">
                <h2 class="heading mb-5">Recent Packages</h2>
            </div>
        </div>
        <div class="row align-items-stretch" id="packagesContainer">
            
        </div>
    </div>
</div>

<script>
    var js = jQuery.noConflict();

    js(document).ready(function () {
        var page = 1; // Initial page number
        var loading = false; // Flag to prevent multiple simultaneous requests
        var allNotificationsLoaded = false; // Flag to track when all notifications have been loaded

        function loadNotifications() {
            if (!loading && !allNotificationsLoaded) {
                loading = true;

                js.ajax({
                    url: "@Url.Action("GetData", "SitePackages")" + "?page=" + page,
                    type: "GET",
                    success: function (html) {
                        if (html.trim() === "") {
                            // No more notifications, stop loading
                            allNotificationsLoaded = true;
                        } else {
                            // Append the new notifications to the container
                            js("#packagesContainer").append(html);
                            page++; // Increment the page number for the next request
                        }

                        loading = false;
                    },
                    error: function (error) {
                        console.error("Error loading packages", error);
                        loading = false;
                    }
                });
            }
        }

        // Detect when the user scrolls to the bottom of the page
        js(window).scroll(function () {
            if (js(window).scrollTop() + js(window).height() >= js(document).height() - 100) {
                // Load more notifications when the user is close to the bottom
                loadNotifications();
            }
        });

        // Initial load of notifications
        loadNotifications();
    });
</script>
